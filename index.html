<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis - Seberapa Engineer Anda?</title>
    <!-- 1. Impor TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Impor Font Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- 3. Impor Bank Soal -->
    <script src="bank_soal.js"></script>
    
    <style>
        /*
         * PERBAIKAN v5:
         * Sebagian besar styling @apply telah dihapus dari sini dan dipindahkan
         * langsung ke HTML (inline) untuk memastikan kompatibilitas browser.
         * Hanya menyisakan hal-hal dasar.
        */
        body {
            font-family: 'Inter', sans-serif;
            /* Tema warna merah marun (Sesuai Kerangka v5) */
            --main-color: #8B0000;
            --main-color-hover: #A52A2A;
            --main-color-light: #fde8e8;
            --correct-color: #16a34a; /* Hijau */
            --wrong-color: #dc2626; /* Merah */
            background-color: var(--main-color);
        }
        
        /* Menyembunyikan halaman yang tidak aktif */
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Input Fields */
        .form-input {
            @apply w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2;
            --tw-ring-color: var(--main-color);
        }

        /* Lencana Gimmick (Tetap di style untuk gradien) */
        .badge {
            @apply w-32 h-32 rounded-full flex items-center justify-center text-white text-5xl font-bold shadow-xl mx-auto;
        }
        .badge-master { @apply bg-gradient-to-br from-yellow-400 to-yellow-600; }
        .badge-senior { @apply bg-gradient-to-br from-gray-400 to-gray-600; }
        .badge-junior { @apply bg-gradient-to-br from-yellow-600 to-yellow-800; }
        .badge-trainee { @apply bg-gradient-to-br from-gray-700 to-gray-900; }
        
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-red-800">

    <!-- Kontainer Utama Aplikasi -->
    <div class="w-full max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden">
        
        <!-- Halaman 1: Registrasi -->
        <div id="page-register" class="page active p-8 md:p-12">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 text-center mb-4">SEBERAPA ENGINEER ANDA?</h1>
            <p class="text-center text-gray-600 mb-8">Selamat datang di kuis PT Multibangun Rekatama Patria!</p>
            
            <form id="register-form" class="space-y-6">
                <div>
                    <label for="nama-lengkap" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                    <input type="text" id="nama-lengkap" class="form-input" required>
                </div>
                <div>
                    <label for="perusahaan" class="block text-sm font-medium text-gray-700 mb-1">Perusahaan / Institusi</label>
                    <input type="text" id="perusahaan" class="form-input" required>
                </div>
                
                <div class="space-y-3 pt-4">
                    <p class="text-xs text-gray-500 bg-gray-50 p-3 rounded-md border">
                        Pemenang adalah yang berhasil mendapatkan peringkat 1 pada leaderboard hingga tanggal 12 November 2025 pukul 15.00 WIB dan berada di tempat (dapat dihubungi). Pemenang bersedia untuk mengurus dan membayar biaya angkut hadiah sepeda listrik yang ada pada booth Multibangun Engineering Hub. Peserta hanya dapat mengikuti Quiz ini sebanyak 1x.
                    </p>
                    <div class="flex items-start pt-2">
                        <input id="disclaimer" name="disclaimer" type="checkbox" class="h-5 w-5 rounded text-red-800 focus:ring-red-700">
                        <label for="disclaimer" class="ml-3 text-sm text-gray-700">Saya sudah membaca dan setuju</label>
                    </div>
                </div>
                
                <div class="pt-4">
                    <!-- Tombol Aksi: Merah/Putih (Styling Inline v5) -->
                    <button type="button" id="btn-register" class="w-full text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 bg-red-800 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:shadow-none" disabled>
                        LANJUTKAN
                    </button>
                </div>
            </form>
        </div>

        <!-- Halaman 2: Peraturan -->
        <div id="page-rules" class="page p-8 md:p-12">
            <h1 class="text-3xl font-extrabold text-gray-900 text-center mb-6">Peraturan & Level Engineer</h1>
            <div class="space-y-4 text-gray-700">
                <p>Anda akan menghadapi <strong>15 soal</strong> pilihan ganda acak.</p>
                <p>Soal akan menguji wawasan <i>engineering</i> Anda (berdasarkan materi geoteknik).</p>
                <p>Jawaban yang sudah di-submit <strong>tidak dapat diubah</strong> atau diulang.</p>
                <p>Skor akhir Anda akan menentukan <strong>Level Engineer</strong> Anda.</p>
            </div>

            <!-- Gimmick Badges -->
            <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <div class="badge badge-master">M</div>
                    <h3 class="font-bold mt-2">Master</h3>
                    <p class="text-sm text-gray-600">Skor 93-100</p>
                </div>
                <div>
                    <div class="badge badge-senior">P</div>
                    <h3 class="font-bold mt-2">Pro</h3>
                    <p class="text-sm text-gray-600">Skor 80-86</p>
                </div>
                <div>
                    <div class="badge badge-junior">R</div>
                    <h3 class="font-bold mt-2">Rookie</h3>
                    <p class="text-sm text-gray-600">Skor 53-73</p>
                </div>
                <div>
                    <div class="badge badge-trainee">N</div>
                    <h3 class="font-bold mt-2">Newbie</h3>
                    <p class="text-sm text-gray-600">Skor &lt; 53</p>
                </div>
            </div>
             <p class="text-sm text-center text-gray-600 mt-4">Merchandise tambahan menanti untuk level <strong>Pro Engineer</strong> ke atas!</p>
            
            <div class="pt-8">
                <!-- Tombol Aksi: Merah/Putih (Styling Inline v5) -->
                <button type="button" id="btn-start-quiz" class="w-full text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 bg-red-800 hover:bg-red-700">
                    MULAI KUIS
                </button>
            </div>
        </div>

        <!-- Halaman 3: Kuis -->
        <div id="page-quiz" class="page p-8 md:p-12">
            <!-- Progress Bar -->
            <div class="mb-4">
                <div class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                    <span>Progress</span>
                    <span id="progress-text">Soal 1 / 15</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="h-2.5 rounded-full bg-red-800" style="width: 7%;"></div>
                </div>
            </div>

            <!-- Konten Soal -->
            <div class="mt-8">
                <h2 id="question-text" class="text-xl font-semibold text-gray-900 mb-6" style="min-height: 100px;">
                    Memuat pertanyaan...
                </h2>
                <!-- Kontainer Pilihan Jawaban (Vertikal) -->
                <div id="answer-options" class="space-y-4"> 
                    <!-- 
                      PERBAIKAN v5:
                      Tombol Pilihan (Putih/Hitam) dengan "Frame" dan "Highlight Biru"
                      akan dimasukkan oleh JS menggunakan kelas-kelas Tailwind inline di bawah ini.
                    -->
                </div>
                
                <!-- Feedback Benar/Salah -->
                <div id="feedback-text" class="mt-4 text-center text-2xl font-bold h-8">
                    <!-- "BENAR!" atau "SALAH!" -->
                </div>
            </div>

            <!-- Tombol Aksi Kuis -->
            <div class="pt-8">
                <!-- Tombol Aksi: Merah/Putih (Styling Inline v5) -->
                <button type="button" id="btn-submit-answer" class="w-full text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 bg-red-800 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:shadow-none" disabled>
                    SUBMIT JAWABAN
                </button>
                <button type="button" id="btn-next-question" class="w-full text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 bg-red-800 hover:bg-red-700 hidden">
                    SOAL BERIKUTNYA
                </button>
            </div>
        </div>
        
        <!-- Halaman 4: Hasil -->
        <div id="page-result" class="page p-8 md:p-12 text-center">
            <h1 class="text-2xl font-bold text-gray-900">Kuis Selesai,</h1>
            <h2 id="result-user-name" class="text-3xl font-extrabold mb-6 text-red-800">[Nama Peserta]!</h2>

            <!-- Lencana Hasil -->
            <div id="result-badge" class="badge badge-trainee mx-auto mb-4">T</div>
            <h3 id="result-level-text" class="text-2xl font-bold text-gray-800">Level Anda: ENGINEER TRAINEE</h3>
            
            <div class="my-6 bg-gray-50 p-4 rounded-lg">
                <div class="flex justify-around">
                    <div>
                        <p class="text-sm text-gray-600">Skor Akhir</p>
                        <p id="result-score-text" class="text-3xl font-bold text-gray-900">0 / 15</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Waktu Selesai</p>
                        <p id="result-duration-text" class="text-3xl font-bold text-gray-900">0s</p>
                    </div>
                </div>
            </div>
            
            <!-- Teks Hasil Kustom -->
            <p id="result-custom-text" class="text-base text-gray-700 px-4">
                Memuat hasil...
            </p>

            <div class="pt-8">
                <!-- Tombol Aksi: Merah/Putih (Styling Inline v5) -->
                <button type="button" id="btn-submit-score" class="w-full text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all duration-300 bg-red-800 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Kirim Skor & Lihat Leaderboard
                </button>
            </div>
        </div>

        <!-- Halaman 5: Leaderboard -->
        <div id="page-leaderboard" class="page p-8 md:p-12">
            <h1 class="text-3xl font-extrabold text-gray-900 text-center mb-6">Leaderboard</h1>
            
            <!-- Timer Hitung Mundur -->
            <div class="text-center bg-yellow-100 border border-yellow-300 text-yellow-800 p-4 rounded-lg mb-6">
                <h3 class="font-bold">Batas Waktu Pemenang Hadiah:</h3>
                <div id="countdown-timer" class="text-xl font-bold">12 November 2025, 15:00 WIB</div>
            </div>
            
            <!-- Tabel Leaderboard -->
            <div class="overflow-x-auto border rounded-lg">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="p-3 font-semibold text-gray-700">Peringkat</th>
                            <th class="p-3 font-semibold text-gray-700">Nama</th>
                            <th class="p-3 font-semibold text-gray-700">Perusahaan</th>
                            <th class="p-3 font-semibold text-gray-700">Skor</th>
                            <th class="p-3 font-semibold text-gray-700">Waktu (detik)</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <!-- Data akan diisi oleh JS -->
                        <tr>
                            <td colspan="5" class="p-8 text-center text-gray-500">
                                Memuat data leaderboard...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pt-8 text-center">
                <!-- 
                  PERBAIKAN v5:
                  Tombol "Ikuti Kuis Lagi" telah dihapus sesuai permintaan.
                -->
            </div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI APLIKASI ---
        
        // !!! PENTING: Ganti dengan URL Google Apps Script Anda yang sudah di-deploy !!!
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/GANTI_DENGAN_URL_ANDA/exec';
        
        const TOTAL_QUESTIONS = 15;
        const DEADLINE_DATE = new Date('2025-11-12T15:00:00');
        
        // --- Variabel State Aplikasi ---
        let currentUser = {
            nama: '',
            perusahaan: ''
        };
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let userScore = 0;
        let selectedAnswer = null; // Menyimpan teks jawaban yang dipilih
        let selectedAnswerButton = null; // Menyimpan referensi DOM tombol yang dipilih
        let startTime = null;
        let endTime = null;
        let finalDuration = 0;
        let isAnswerSubmitted = false;
        let leaderboardInterval = null; // <!-- TAMBAHKAN BARIS INI -->

        // --- Selektor DOM ---
        const pages = document.querySelectorAll('.page');
        const registerForm = {
            nama: document.getElementById('nama-lengkap'),
            perusahaan: document.getElementById('perusahaan'),
            disclaimer: document.getElementById('disclaimer'),
            submitBtn: document.getElementById('btn-register')
        };
        const btnStartQuiz = document.getElementById('btn-start-quiz');
        
        // Elemen Halaman Kuis
        const quizPage = {
            progressText: document.getElementById('progress-text'),
            progressBar: document.getElementById('progress-bar'),
            questionText: document.getElementById('question-text'),
            answerOptions: document.getElementById('answer-options'),
            feedbackText: document.getElementById('feedback-text'),
            submitBtn: document.getElementById('btn-submit-answer'),
            nextBtn: document.getElementById('btn-next-question')
        };
        
        // Elemen Halaman Hasil
        const resultPage = {
            userName: document.getElementById('result-user-name'),
            badge: document.getElementById('result-badge'),
            levelText: document.getElementById('result-level-text'),
            scoreText: document.getElementById('result-score-text'),
            durationText: document.getElementById('result-duration-text'),
            customText: document.getElementById('result-custom-text'),
            submitScoreBtn: document.getElementById('btn-submit-score')
        };
        
        // Elemen Halaman Leaderboard
        const leaderboardPage = {
            countdown: document.getElementById('countdown-timer'),
            body: document.getElementById('leaderboard-body')
            // PERBAIKAN v5: 'restartBtn' dihapus
        };

        // --- Fungsi Utama ---

        // Fungsi untuk berpindah halaman
        function showPage(pageId) {
            // <!-- TAMBAHAN: Hentikan interval leaderboard jika sedang berjalan -->
            if (leaderboardInterval) {
                clearInterval(leaderboardInterval);
                leaderboardInterval = null;
            }

            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // <!-- TAMBAHAN: Mulai interval jika kita ada di halaman leaderboard -->
            if (pageId === 'page-leaderboard') {
                loadLeaderboard(); // Muat data pertama kali
                leaderboardInterval = setInterval(loadLeaderboard, 15000); // Refresh setiap 15 detik
            }
        }

        // --- Halaman 1: Logika Registrasi ---
        
        function validateRegisterForm() {
            const isNamaFilled = registerForm.nama.value.trim() !== '';
            const isPerusahaanFilled = registerForm.perusahaan.value.trim() !== '';
            const isDisclaimerChecked = registerForm.disclaimer.checked;
            
            registerForm.submitBtn.disabled = !(isNamaFilled && isPerusahaanFilled && isDisclaimerChecked);
        }
        
        function handleRegister() {
            currentUser.nama = registerForm.nama.value.trim();
            currentUser.perusahaan = registerForm.perusahaan.value.trim();
            showPage('page-rules');
        }

        // --- Halaman 2 & 3: Logika Kuis ---
        
        function startQuiz() {
            // Reset state kuis
            currentQuestionIndex = 0;
            userScore = 0;
            selectedAnswer = null;
            selectedAnswerButton = null;
            isAnswerSubmitted = false;
            
            // Ambil dan acak soal dari bank_soal.js
            const shuffledQuestions = [...questionBank].sort(() => 0.5 - Math.random());
            quizQuestions = shuffledQuestions.slice(0, TOTAL_QUESTIONS);
            
            // Mulai timer
            startTime = new Date();
            
            displayQuestion();
            showPage('page-quiz');
        }

        function displayQuestion() {
            // Reset feedback dan tombol
            selectedAnswer = null;
            selectedAnswerButton = null;
            isAnswerSubmitted = false;
            quizPage.feedbackText.textContent = '';
            quizPage.submitBtn.disabled = true;
            quizPage.submitBtn.classList.remove('hidden');
            quizPage.nextBtn.classList.add('hidden');
            
            // Update progress
            const questionNumber = currentQuestionIndex + 1;
            quizPage.progressText.textContent = `Soal ${questionNumber} / ${TOTAL_QUESTIONS}`;
            quizPage.progressBar.style.width = `${(questionNumber / TOTAL_QUESTIONS) * 100}%`;
            
            // Tampilkan soal dan pilihan
            const q = quizQuestions[currentQuestionIndex];
            quizPage.questionText.textContent = q.question;
            
            quizPage.answerOptions.innerHTML = ''; // Kosongkan pilihan lama
            q.options.forEach((option, index) => {
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                const button = document.createElement('button');
                button.type = 'button';

                // PERBAIKAN v5: Styling "Frame" (Putih/Hitam) ditambahkan langsung di sini
                button.className = 'w-full text-left text-gray-800 bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm transition-all duration-200 flex items-start hover:border-gray-400 disabled:opacity-70 disabled:cursor-not-allowed';
                
                button.innerHTML = `<span class="font-bold mr-3 min-w-[1.5em]">${optionLetter}.</span><span class="flex-grow break-words">${option}</span>`;
                button.onclick = () => selectAnswer(button, option);
                quizPage.answerOptions.appendChild(button);
            });
        }
        
        function selectAnswer(button, answer) {
            // Hanya izinkan pemilihan jika jawaban belum disubmit
            if (isAnswerSubmitted) return; 

            // Hapus 'selected' (Highlight Biru) dari semua tombol
            document.querySelectorAll('#answer-options button').forEach(btn => {
                // PERBAIKAN v5: Hapus kelas inline
                btn.classList.remove('bg-blue-100', 'border-blue-500', 'ring-2', 'ring-blue-300');
            });
            
            // Tambah 'selected' (Highlight Biru) ke tombol yang diklik
            // PERBAIKAN v5: Tambah kelas inline
            button.classList.add('bg-blue-100', 'border-blue-500', 'ring-2', 'ring-blue-300');
            
            selectedAnswer = answer; // Simpan teks jawaban
            selectedAnswerButton = button; // Simpan referensi tombol
            quizPage.submitBtn.disabled = false;
        }

        function submitAnswer() {
            if (!selectedAnswerButton || isAnswerSubmitted) return; 

            isAnswerSubmitted = true; 
            quizPage.submitBtn.disabled = true; 

            // Nonaktifkan semua pilihan
            document.querySelectorAll('#answer-options button').forEach(btn => {
                btn.disabled = true;
            });

            // Sembunyikan tombol Submit, tampilkan tombol Next
            quizPage.submitBtn.classList.add('hidden');
            quizPage.nextBtn.classList.remove('hidden');

            // Cek jawaban
            const q = quizQuestions[currentQuestionIndex];
            const correctAnwer = q.answer;
            
            if (selectedAnswer === correctAnwer) {
                userScore++;
                // PERBAIKAN v5: Tambah kelas inline untuk "Correct" (Hijau)
                selectedAnswerButton.classList.add('bg-green-100', 'border-green-500', 'text-green-800', 'font-semibold');
                quizPage.feedbackText.textContent = 'BENAR!';
                quizPage.feedbackText.style.color = 'var(--correct-color)';
            } else {
                // PERBAIKAN v5: Tambah kelas inline untuk "Wrong" (Merah)
                selectedAnswerButton.classList.add('bg-red-100', 'border-red-500', 'text-red-800', 'font-semibold');
                quizPage.feedbackText.textContent = 'SALAH!';
                quizPage.feedbackText.style.color = 'var(--wrong-color)';
            }
            
            // Ubah tombol Next di soal terakhir
            if (currentQuestionIndex === TOTAL_QUESTIONS - 1) {
                quizPage.nextBtn.textContent = 'Lihat Hasil';
            } else {
                quizPage.nextBtn.textContent = 'Soal Berikutnya';
            }
        }
        
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                displayQuestion();
            } else {
                showResult();
            }
        }
        
        // --- Halaman 4: Logika Hasil ---
        
        function showResult() {
            endTime = new Date();
            finalDuration = (endTime - startTime) / 1000; // Durasi dalam detik
            const scorePercent = (userScore / TOTAL_QUESTIONS) * 100;

            resultPage.userName.textContent = `${currentUser.nama}!`;
            resultPage.scoreText.textContent = `${userScore} / ${TOTAL_QUESTIONS}`;
            resultPage.durationText.textContent = `${finalDuration.toFixed(1)}s`;

            // Logika Badge dan Teks Kustom
            let level = 'Newbie Engineer';
            let badgeClass = 'badge-trainee';
            let badgeLetter = 'N';
            
            if (scorePercent >= 93) { // 14-15 benar
                level = 'Master Engineer';
                badgeClass = 'badge-master';
                badgeLetter = 'M';
            } else if (scorePercent >= 80) { // 12-13 benar
                level = 'Pro Engineer';
                badgeClass = 'badge-senior';
                badgeLetter = 'P';
            } else if (scorePercent >= 53) { // 8-11 benar
                level = 'Rookie Engineer';
                badgeClass = 'badge-junior';
                badgeLetter = 'R';
            }

            resultPage.badge.className = `badge ${badgeClass} mx-auto mb-4`;
            resultPage.badge.textContent = badgeLetter;
            resultPage.levelText.textContent = `Level Anda: ${level}`;
            
            // Teks Kustom (>= 80% atau < 80%)
            if (scorePercent >= 80) {
                resultPage.customText.innerHTML = `<strong>Selamat!</strong> Kamu mendapatkan merchandise tambahan dan berkesempatan untuk melakukan <i>lucky draw</i>. Silahkan hubungi tim dari Multibangun!`;
            } else {
                resultPage.customText.innerHTML = `<strong>Pengetahuan Anda sudah teruji!</strong> Asah terus kemampuan Anda untuk menjadi Master Engineer. Anda berkesempatan melakukan <i>lucky draw</i>, silahkan hubungi tim dari Multibangun!`;
            }

            showPage('page-result');
        }

        // --- Halaman 5: Logika Leaderboard ---
        
        async function submitScoreAndShowLeaderboard() {
            const btn = resultPage.submitScoreBtn;
            btn.disabled = true;
            btn.textContent = 'Mengirim Skor...';

            const data = {
                nama: currentUser.nama,
                perusahaan: currentUser.perusahaan,
                skor: userScore, // Kirim sebagai angka
                durasi: finalDuration // Kirim sebagai angka
            };

            try {
                // Mengirim data ke Google Apps Script
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Penting untuk Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                console.error('Gagal mengirim skor:', error);
                // Tetap lanjutkan meski gagal kirim, agar user bisa lihat leaderboard
            }
            
            // Setelah mengirim, muat leaderboard
            // Beri jeda 1 detik agar Google Sheet sempat memproses data
            setTimeout(() => {
                // <!-- MODIFIKASI: Cukup panggil showPage. -->
                // <!-- loadLeaderboard() dan interval akan di-trigger oleh showPage -->
                showPage('page-leaderboard'); 
                // loadLeaderboard(); // <-- HAPUS BARIS INI
                // showPage('page-leaderboard'); // <-- HAPUS BARIS INI
                btn.disabled = false;
                btn.textContent = 'Kirim Skor & Lihat Leaderboard';
            }, 1000); 
        }

        async function loadLeaderboard() {
            leaderboardPage.body.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-500">Memuat data leaderboard...</td></tr>`;
            
            try {
                // Tambahkan parameter cache-busting untuk mencegah data lama
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?timestamp=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`Gagal mengambil data (${response.status})`);
                
                const data = await response.json();
                
                leaderboardPage.body.innerHTML = ''; // Kosongkan tabel
                
                if (!data || data.length === 0) {
                    leaderboardPage.body.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-500">Belum ada data. Jadilah yang pertama!</td></tr>`;
                    return;
                }
                
                // Tampilkan data di tabel
                data.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    tr.className = 'border-b hover:bg-gray-50';
                    
                    // Highlight baris user saat ini
                    if (row.name === currentUser.nama && Math.abs(row.duration - finalDuration) < 0.1) {
                        tr.className += ' bg-red-100 font-bold';
                        tr.style.backgroundColor = 'var(--main-color-light)';
                    }
                    
                    tr.innerHTML = `
                        <td class="p-3">${index + 1}</td>
                        <td class="p-3">${row.name}</td>
                        <td class="p-3">${row.company}</td>
                        <td class="p-3">${row.score} / ${TOTAL_QUESTIONS}</td>
                        <td class="p-3">${Number(row.duration).toFixed(1)}s</td>
                    `;
                    leaderboardPage.body.appendChild(tr);
                });

            } catch (error) {
                console.error('Error memuat leaderboard:', error);
                leaderboardPage.body.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-red-500">Gagal memuat data leaderboard. Periksa koneksi atau URL Apps Script.</td></tr>`;
            }
        }
        
        // --- Inisialisasi Aplikasi ---
        document.addEventListener('DOMContentLoaded', () => {
            // Event Listeners Halaman 1
            registerForm.nama.addEventListener('input', validateRegisterForm);
            registerForm.perusahaan.addEventListener('input', validateRegisterForm);
            registerForm.disclaimer.addEventListener('change', validateRegisterForm);
            registerForm.submitBtn.addEventListener('click', handleRegister);
            
            // Event Listeners Halaman 2
            btnStartQuiz.addEventListener('click', startQuiz);
            
            // Event Listeners Halaman 3
            quizPage.submitBtn.addEventListener('click', submitAnswer);
            quizPage.nextBtn.addEventListener('click', nextQuestion);
            
            // Event Listeners Halaman 4
            resultPage.submitScoreBtn.addEventListener('click', submitScoreAndShowLeaderboard);

            // PERBAIKAN v5: Event listener untuk 'restartBtn' dihapus
        });

    </script>
</body>
</html>



